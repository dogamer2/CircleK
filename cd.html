<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Access Code Admin</title>
</head>
<body>
  <script>
    // Password protection
    const password = prompt("Enter admin password:");
    if (password !== "3723") {
      document.body.innerHTML = "<h2>Access Denied</h2>";
      throw new Error("Access denied");
    }
  </script>

  <h1>Access Code Admin</h1>
  <div id="codes"></div>
  <button id="new">Generate New Code</button>

  <script type="module">
    import { supabase, generateCode } from "./supabase.js";

    async function loadCodes() {
      const { data, error } = await supabase
        .from("access_codes")
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        document.getElementById("codes").innerHTML = "Error loading codes";
        console.error(error);
        return;
      }

      document.getElementById("codes").innerHTML =
        data.map(c => `<div>${c.code} â€” ${c.used ? "USED" : "UNUSED"}</div>`).join("");
    }

    loadCodes();

    document.getElementById('new').onclick = async () => {
      const code = crypto.randomUUID().slice(0,8).toUpperCase();
      await generateCode(code);
      loadCodes();
    };
  </script>
</body>
</html>
